{% extends "base.html" %}
{% block title %}Folha de Impressão - Pedido{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto bg-white rounded-lg shadow p-6">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-xl font-semibold">Folha de Impressão - Pedido #{{ pedido.id }}</h1>
    <div class="flex gap-2">
      <a href="{{ url_for('reception.regulacao') }}" class="inline-flex items-center px-3 py-2 rounded border border-slate-200 text-sm text-slate-700">← Voltar à Recepção Regulação</a>
      <button onclick="window.print()" class="btn-primary">Imprimir</button>
    </div>
  </div>

  <section class="mb-4">
    <h2 class="font-semibold text-slate-700 mb-2">Dados do Paciente</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
      <div><span class="text-slate-600">Nome:</span> <span class="font-medium">{{ paciente.nome or '-' }}</span></div>
      <div><span class="text-slate-600">CPF:</span> <span class="font-medium">{{ paciente.cpf or '-' }}</span></div>
      <div><span class="text-slate-600">Data de Nascimento:</span> <span class="font-medium">{{ paciente.data_nascimento or '-' }}</span></div>
      <div><span class="text-slate-600">Cartão SUS:</span> <span class="font-medium">{{ paciente.cartao_sus or '-' }}</span></div>
      <div class="md:col-span-2"><span class="text-slate-600">Endereço:</span> <span class="font-medium">{{ paciente.endereco or '-' }}</span></div>
      <div><span class="text-slate-600">Telefone 1:</span> <span class="font-medium">{{ paciente.telefone_principal or '-' }}</span></div>
      <div><span class="text-slate-600">Telefone 2:</span> <span class="font-medium">{{ paciente.telefone_secundario or '-' }}</span></div>
      <div class="md:col-span-2"><span class="text-slate-600">Email:</span> <span class="font-medium">{{ paciente.email or '-' }}</span></div>
    </div>
  </section>

  <section class="mb-4">
    <h2 class="font-semibold text-slate-700 mb-2">Dados do Pedido</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
      <div><span class="text-slate-600">Pedido ID:</span> <span class="font-medium">{{ pedido.id }}</span></div>
      <div><span class="text-slate-600">Solicitado em:</span> <span class="font-medium">{{ pedido.data_solicitacao.strftime('%d/%m/%Y %H:%M') if pedido.data_solicitacao else '-' }}</span></div>
      <div><span class="text-slate-600">Unidade:</span> <span class="font-medium">{{ unidade.nome if unidade else (pedido.unidade_nome or '-') }}</span></div>
      <div><span class="text-slate-600">Tipo:</span> <span class="font-medium">{{ pedido.tipo_solicitacao or '-' }}</span></div>
      <div><span class="text-slate-600">Solicitação:</span> <span class="font-medium">{{ pedido.nome_solicitacao or (exame.nome if exame else (consulta.nome if consulta else '-')) }}</span></div>
      <div><span class="text-slate-600">Prioridade:</span> <span class="font-medium">{{ pedido.prioridade or '-' }}</span></div>
      <div><span class="text-slate-600">Data do Exame:</span> <span class="font-medium">{{ pedido.data_exame.strftime('%d/%m/%Y') if pedido.data_exame else '-' }}</span></div>
      <div><span class="text-slate-600">Horário:</span> <span class="font-medium">{{ pedido.horario_exame.strftime('%H:%M') if pedido.horario_exame else '-' }}</span></div>
      <div class="md:col-span-2"><span class="text-slate-600">Observações:</span>
        <div class="whitespace-pre-wrap mt-1 text-sm text-slate-800">{{ pedido.observacoes or '-' }}</div>
      </div>
    </div>
  </section>

  <section>
    <h2 class="font-semibold text-slate-700 mb-2">Histórico</h2>
    {% if historico %}
      <ol class="list-decimal list-inside space-y-2 text-sm">
        {% for ev in historico %}
          <li>
            <div class="flex justify-between">
              <div>
                <div class="font-medium">{{ ev.status.replace('_',' ').title() }}</div>
                {% if ev.descricao %}<div class="text-slate-600">{{ ev.descricao }}</div>{% endif %}
              </div>
              <div class="text-xs text-slate-400">{{ ev.criado_em.strftime('%d/%m/%Y %H:%M') if ev.criado_em else '' }}</div>
            </div>
          </li>
        {% endfor %}
      </ol>
    {% else %}
      <p class="text-sm text-slate-500 italic">Nenhum histórico disponível</p>
    {% endif %}
  </section>

  <div class="mt-6 flex gap-2">
    <a href="{{ url_for('reception.regulacao') }}" class="inline-flex items-center px-3 py-2 rounded border border-slate-200 text-sm text-slate-700">← Voltar à Recepção Regulação</a>
    <button onclick="window.print()" class="btn-primary">Imprimir</button>
  </div>
</div>

<style>
  @media print {
    .btn-primary, a { display: none; }
  }
</style>
{% endblock %}